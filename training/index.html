<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI for Clinical Programming — Training Guide</title>
<style>
  :root {
    --navy: #0d1b2a;
    --navy-mid: #1b2e45;
    --navy-light: #243b55;
    --gold: #c9a84c;
    --gold-light: #e8c97a;
    --white: #f0f4f8;
    --text: #d0dae8;
    --text-dim: #8fa3bc;
    --green: #4caf87;
    --red: #e05c5c;
    --blue: #5b9bd5;
    --purple: #9b6db5;
    --teal: #4db5b5;
    --orange: #e07c4c;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--navy);
    color: var(--text);
    line-height: 1.6;
  }
  a { color: var(--gold-light); text-decoration: none; }
  a:hover { text-decoration: underline; }

  /* ── HERO ── */
  .hero {
    background: linear-gradient(135deg, var(--navy) 0%, var(--navy-mid) 60%, #1a3050 100%);
    border-bottom: 2px solid var(--gold);
    padding: 60px 40px 50px;
    text-align: center;
  }
  .hero-badge {
    display: inline-block;
    background: var(--gold);
    color: var(--navy);
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 4px 14px;
    border-radius: 20px;
    margin-bottom: 20px;
  }
  .hero h1 {
    font-size: 2.6rem;
    font-weight: 700;
    color: var(--white);
    line-height: 1.2;
    margin-bottom: 16px;
  }
  .hero h1 span { color: var(--gold); }
  .hero p {
    font-size: 1.15rem;
    color: var(--text-dim);
    max-width: 700px;
    margin: 0 auto 30px;
  }
  .hero-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    flex-wrap: wrap;
  }
  .stat { text-align: center; }
  .stat-num { font-size: 2rem; font-weight: 700; color: var(--gold); }
  .stat-label { font-size: 0.8rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }

  /* ── NAV ── */
  .nav {
    background: var(--navy-mid);
    border-bottom: 1px solid rgba(255,255,255,0.08);
    padding: 0 40px;
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    gap: 4px;
    overflow-x: auto;
  }
  .nav a {
    display: block;
    padding: 14px 18px;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--text-dim);
    white-space: nowrap;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .nav a:hover, .nav a.active {
    color: var(--gold);
    border-bottom-color: var(--gold);
    text-decoration: none;
  }

  /* ── SECTIONS ── */
  .section { padding: 60px 40px; max-width: 1200px; margin: 0 auto; }
  .section-title {
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--white);
    margin-bottom: 8px;
  }
  .section-sub {
    font-size: 1rem;
    color: var(--text-dim);
    margin-bottom: 40px;
  }
  .divider { border: none; border-top: 1px solid rgba(255,255,255,0.08); margin: 0; }

  /* ── PROBLEM SECTION ── */
  .problem-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }
  .problem-card {
    background: var(--navy-mid);
    border: 1px solid rgba(255,255,255,0.08);
    border-left: 3px solid var(--red);
    border-radius: 8px;
    padding: 20px;
  }
  .problem-card h4 { color: var(--white); margin-bottom: 8px; font-size: 1rem; }
  .problem-card p { color: var(--text-dim); font-size: 0.9rem; }

  /* ── CURRICULUM MAP ── */
  .curriculum-timeline {
    position: relative;
    padding-left: 30px;
  }
  .curriculum-timeline::before {
    content: '';
    position: absolute;
    left: 10px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(to bottom, var(--gold), var(--teal), var(--purple));
  }
  .chapter-card {
    position: relative;
    background: var(--navy-mid);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    margin-bottom: 16px;
    cursor: pointer;
    transition: border-color 0.2s, transform 0.1s;
    overflow: hidden;
  }
  .chapter-card:hover { border-color: rgba(201,168,76,0.4); transform: translateX(2px); }
  .chapter-card.open { border-color: var(--gold); }
  .chapter-card::before {
    content: '';
    position: absolute;
    left: -26px;
    top: 26px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--gold);
    border: 2px solid var(--navy);
    z-index: 1;
  }
  .chapter-card.capstone::before { background: var(--purple); }
  .chapter-header {
    display: flex;
    align-items: center;
    padding: 18px 22px;
    gap: 16px;
  }
  .ch-num {
    background: rgba(201,168,76,0.15);
    color: var(--gold);
    font-weight: 700;
    font-size: 0.85rem;
    padding: 4px 10px;
    border-radius: 20px;
    white-space: nowrap;
    min-width: 60px;
    text-align: center;
  }
  .capstone .ch-num { background: rgba(155,109,181,0.2); color: var(--purple); }
  .ch-info { flex: 1; }
  .ch-title { font-size: 1.05rem; font-weight: 600; color: var(--white); }
  .ch-tagline { font-size: 0.85rem; color: var(--text-dim); margin-top: 2px; }
  .ch-meta {
    display: flex;
    gap: 16px;
    align-items: center;
  }
  .ch-level {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    padding: 3px 8px;
    border-radius: 12px;
  }
  .level-consumer { background: rgba(76,175,135,0.2); color: var(--green); }
  .level-operator { background: rgba(91,155,213,0.2); color: var(--blue); }
  .level-builder { background: rgba(201,168,76,0.2); color: var(--gold); }
  .level-architect { background: rgba(155,109,181,0.2); color: var(--purple); }
  .ch-duration { font-size: 0.82rem; color: var(--text-dim); }
  .ch-toggle { color: var(--text-dim); font-size: 1.2rem; transition: transform 0.2s; }
  .chapter-card.open .ch-toggle { transform: rotate(180deg); }

  .chapter-body {
    display: none;
    border-top: 1px solid rgba(255,255,255,0.06);
    padding: 22px;
  }
  .chapter-card.open .chapter-body { display: block; }
  .ch-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }
  @media (max-width: 700px) { .ch-grid { grid-template-columns: 1fr; } }
  .ch-section-title {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--gold);
    margin-bottom: 8px;
  }
  .ch-list { list-style: none; }
  .ch-list li {
    padding: 4px 0;
    font-size: 0.88rem;
    color: var(--text);
    padding-left: 16px;
    position: relative;
  }
  .ch-list li::before {
    content: '→';
    position: absolute;
    left: 0;
    color: var(--gold);
  }
  .capstone-connection {
    background: rgba(201,168,76,0.07);
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 6px;
    padding: 12px 16px;
    font-size: 0.88rem;
    color: var(--text);
    margin-top: 14px;
  }
  .capstone-connection strong { color: var(--gold); }

  .prereq-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
  .tag {
    font-size: 0.75rem;
    padding: 3px 9px;
    border-radius: 12px;
    background: rgba(255,255,255,0.07);
    color: var(--text-dim);
  }

  /* ── PROGRESS TRACKER ── */
  .progress-section {
    background: var(--navy-mid);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px;
    padding: 28px;
    margin-bottom: 40px;
  }
  .progress-row {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .progress-row:last-child { border-bottom: none; }
  .progress-checkbox {
    width: 20px;
    height: 20px;
    border: 2px solid var(--gold);
    border-radius: 4px;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: background 0.2s;
  }
  .progress-checkbox.checked { background: var(--gold); }
  .progress-checkbox.checked::after { content: '✓'; color: var(--navy); font-size: 13px; font-weight: 700; }
  .progress-label { flex: 1; font-size: 0.9rem; }
  .progress-label.checked { color: var(--text-dim); text-decoration: line-through; }
  .progress-bar-wrap { margin-top: 16px; }
  .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; }
  .progress-fill { height: 100%; background: linear-gradient(to right, var(--gold), var(--green)); border-radius: 3px; transition: width 0.4s; }
  .progress-pct { font-size: 0.85rem; color: var(--text-dim); margin-top: 6px; }

  /* ── CAPSTONE SECTION ── */
  .capstone-hero {
    background: linear-gradient(135deg, rgba(155,109,181,0.15) 0%, rgba(13,27,42,0) 100%);
    border: 1px solid rgba(155,109,181,0.3);
    border-radius: 12px;
    padding: 32px;
    margin-bottom: 40px;
    text-align: center;
  }
  .capstone-hero h2 { font-size: 1.8rem; color: var(--purple); margin-bottom: 12px; }
  .capstone-hero p { color: var(--text-dim); max-width: 700px; margin: 0 auto; }

  /* challenges table */
  .challenge-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 40px;
    font-size: 0.88rem;
  }
  .challenge-table th {
    background: rgba(255,255,255,0.06);
    padding: 12px 16px;
    text-align: left;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
    font-weight: 600;
  }
  .challenge-table td {
    padding: 12px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    vertical-align: top;
  }
  .challenge-table tr:last-child td { border-bottom: none; }
  .challenge-table tr:hover td { background: rgba(255,255,255,0.02); }
  .challenge-text { color: var(--text); }
  .hard-part { color: var(--text-dim); font-size: 0.83rem; margin-top: 4px; font-style: italic; }
  .ai-solution { color: var(--green); }
  .ch-tag {
    display: inline-block;
    background: rgba(201,168,76,0.15);
    color: var(--gold);
    font-size: 0.72rem;
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 10px;
    white-space: nowrap;
  }

  /* ── PIPELINE DIAGRAM ── */
  .pipeline-wrap {
    overflow-x: auto;
    margin-bottom: 40px;
  }
  .pipeline {
    display: flex;
    align-items: stretch;
    gap: 0;
    min-width: 900px;
  }
  .pipe-stage {
    flex: 1;
    background: var(--navy-mid);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 18px 14px;
    position: relative;
    text-align: center;
    transition: background 0.2s;
  }
  .pipe-stage:hover { background: rgba(27,46,69,0.9); }
  .pipe-stage:not(:last-child)::after {
    content: '▶';
    position: absolute;
    right: -12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gold);
    font-size: 0.8rem;
    z-index: 2;
    background: var(--navy);
    padding: 2px;
  }
  .pipe-stage.special-human { border-top: 3px solid var(--orange); }
  .pipe-stage.stage-spec { border-top: 3px solid var(--blue); }
  .pipe-stage.stage-review { border-top: 3px solid var(--blue); }
  .pipe-stage.stage-prod { border-top: 3px solid var(--green); }
  .pipe-stage.stage-qc { border-top: 3px solid var(--teal); }
  .pipe-stage.stage-compare { border-top: 3px solid var(--gold); }
  .pipe-stage.stage-validate { border-top: 3px solid var(--purple); }
  .pipe-num { font-size: 0.7rem; color: var(--text-dim); margin-bottom: 6px; }
  .pipe-name { font-size: 0.88rem; font-weight: 700; color: var(--white); margin-bottom: 4px; }
  .pipe-agent { font-size: 0.72rem; color: var(--text-dim); margin-bottom: 6px; }
  .pipe-output {
    font-size: 0.72rem;
    background: rgba(0,0,0,0.25);
    border-radius: 4px;
    padding: 4px 6px;
    color: var(--text-dim);
    font-family: monospace;
    word-break: break-all;
  }
  .human-badge {
    display: inline-block;
    background: rgba(224,124,76,0.2);
    color: var(--orange);
    font-size: 0.68rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 8px;
    margin-bottom: 4px;
  }
  .pipe-loop-label {
    text-align: center;
    font-size: 0.78rem;
    color: var(--gold);
    margin-bottom: 8px;
    font-style: italic;
  }

  /* ── EXERCISES ── */
  .exercise-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }
  .exercise-card {
    background: var(--navy-mid);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    padding: 22px;
    position: relative;
    overflow: hidden;
  }
  .exercise-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
  }
  .ex-c1::before { background: var(--blue); }
  .ex-c2::before { background: var(--red); }
  .ex-c3::before { background: var(--green); }
  .ex-c4::before { background: var(--purple); }
  .ex-num { font-size: 0.72rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); margin-bottom: 8px; }
  .ex-title { font-size: 1rem; font-weight: 700; color: var(--white); margin-bottom: 10px; }
  .ex-desc { font-size: 0.88rem; color: var(--text-dim); margin-bottom: 14px; }
  .ex-need { font-size: 0.8rem; color: var(--text); }
  .ex-need strong { color: var(--gold); }
  .ex-time {
    position: absolute;
    top: 18px;
    right: 18px;
    font-size: 0.75rem;
    color: var(--text-dim);
    background: rgba(255,255,255,0.06);
    padding: 3px 8px;
    border-radius: 10px;
  }
  .ex-skill-tip {
    margin-top: 14px;
    background: rgba(201,168,76,0.08);
    border-radius: 6px;
    padding: 10px 12px;
    font-size: 0.82rem;
    color: var(--text-dim);
  }
  .ex-skill-tip code { color: var(--gold); font-family: monospace; }

  /* ── 5 AGENTS ── */
  .agents-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin-bottom: 40px;
  }
  .agent-card {
    background: var(--navy-mid);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    padding: 20px;
  }
  .agent-icon { font-size: 1.6rem; margin-bottom: 8px; }
  .agent-name { font-weight: 700; color: var(--white); font-size: 0.95rem; margin-bottom: 4px; }
  .agent-model {
    font-size: 0.72rem;
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 8px;
    margin-bottom: 8px;
    display: inline-block;
  }
  .model-sonnet { background: rgba(91,155,213,0.2); color: var(--blue); }
  .model-opus { background: rgba(155,109,181,0.2); color: var(--purple); }
  .agent-role { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 8px; }
  .agent-reads { font-size: 0.78rem; color: var(--text-dim); }
  .agent-reads strong { color: var(--text); }

  /* ── QUICK REFERENCE ── */
  .ref-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }
  @media (max-width: 800px) { .ref-grid { grid-template-columns: 1fr; } }
  .ref-card {
    background: var(--navy-mid);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    padding: 22px;
  }
  .ref-card h3 { font-size: 0.9rem; font-weight: 700; color: var(--gold); margin-bottom: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
  .cmd-list { list-style: none; }
  .cmd-list li { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.04); }
  .cmd-list li:last-child { border-bottom: none; }
  .cmd { font-family: monospace; font-size: 0.83rem; color: var(--gold-light); }
  .cmd-desc { font-size: 0.82rem; color: var(--text-dim); margin-left: 8px; }

  /* ── FOOTER ── */
  footer {
    background: var(--navy-mid);
    border-top: 1px solid rgba(255,255,255,0.06);
    text-align: center;
    padding: 30px;
    font-size: 0.83rem;
    color: var(--text-dim);
  }

  /* ── UTILITIES ── */
  .pill {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 0.78rem;
    font-weight: 600;
  }
  .highlight { color: var(--gold); font-weight: 600; }
  .note {
    background: rgba(201,168,76,0.08);
    border-left: 3px solid var(--gold);
    border-radius: 0 6px 6px 0;
    padding: 14px 18px;
    font-size: 0.9rem;
    margin-bottom: 24px;
  }
  .print-btn {
    display: inline-block;
    background: rgba(201,168,76,0.15);
    color: var(--gold);
    border: 1px solid rgba(201,168,76,0.3);
    padding: 8px 18px;
    border-radius: 6px;
    font-size: 0.82rem;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s;
  }
  .print-btn:hover { background: rgba(201,168,76,0.25); }
  @media print {
    .nav, .print-btn { display: none; }
    .chapter-body { display: block !important; }
    body { background: white; color: black; }
  }
</style>
</head>
<body>

<!-- ══════════════════════════════════════════════ HERO -->
<div class="hero">
  <div class="hero-badge">Clinical Programming Training</div>
  <h1>AI for Clinical Programming<br><span>Your Complete Learning Guide</span></h1>
  <p>A progressive journey from understanding AI tools to building a fully automated SDTM pipeline. Seven chapters, one capstone, all connected.</p>
  <div class="hero-stats">
    <div class="stat"><div class="stat-num">7</div><div class="stat-label">Chapters</div></div>
    <div class="stat"><div class="stat-num">30+</div><div class="stat-label">Hours</div></div>
    <div class="stat"><div class="stat-num">5</div><div class="stat-label">AI Agents</div></div>
    <div class="stat"><div class="stat-num">1</div><div class="stat-label">Capstone</div></div>
  </div>
</div>

<!-- ══════════════════════════════════════════════ NAV -->
<nav class="nav">
  <a href="#problem">The Problem</a>
  <a href="#curriculum">Curriculum</a>
  <a href="#progress">My Progress</a>
  <a href="#capstone">Capstone</a>
  <a href="#pipeline">Pipeline</a>
  <a href="#exercises">Exercises</a>
  <a href="#agents">Agents</a>
  <a href="#reference">Quick Reference</a>
</nav>

<!-- ══════════════════════════════════════════════ THE PROBLEM -->
<hr class="divider">
<div class="section" id="problem">
  <div class="section-title">Why Does SDTM Programming Need AI?</div>
  <div class="section-sub">Let's be honest about the problems before we talk about solutions.</div>

  <div class="problem-grid">
    <div class="problem-card">
      <h4>It's relentlessly repetitive</h4>
      <p>The same 20 DM variables get mapped in every single study. The same iso_date logic. The same USUBJID derivation. The same CT lookups. Again. And again.</p>
    </div>
    <div class="problem-card">
      <h4>Errors surface too late</h4>
      <p>Without a spec-driven process, mistakes in codelist assignment or derivation logic aren't caught until a P21 run — sometimes days or weeks after the code was written.</p>
    </div>
    <div class="problem-card">
      <h4>QC double-programming is slow</h4>
      <p>Two programmers write the same boilerplate from scratch, then someone manually compares the outputs. This is important — but it doesn't have to be this tedious.</p>
    </div>
    <div class="problem-card">
      <h4>SDTM IG is 400+ pages</h4>
      <p>Finding the right variable definition, checking which codelist applies, understanding "Other Specify" options for RACE — this involves searching through a massive PDF repeatedly.</p>
    </div>
    <div class="problem-card">
      <h4>Controlled terminology changes</h4>
      <p>CDISC publishes new CT packages quarterly. Checking that your values are still valid against the current codelist requires manual NCI EVS lookups every cycle.</p>
    </div>
    <div class="problem-card">
      <h4>Doesn't scale</h4>
      <p>A typical NDA submission has 20+ SDTM domains. DM, AE, VS, LB, CM, MH... multiply the manual work per domain across a large pharma team and you understand the problem.</p>
    </div>
  </div>

  <div class="note">
    <strong class="highlight">The good news:</strong> Every one of these problems has a specific AI-powered solution in this curriculum. By the capstone, you'll be able to point to exactly which line of code solves each one.
  </div>
</div>

<!-- ══════════════════════════════════════════════ CURRICULUM -->
<hr class="divider">
<div class="section" id="curriculum">
  <div class="section-title">The Curriculum</div>
  <div class="section-sub">Click any chapter to see what you learn and how it connects to the capstone. The progress markers on the left show where you are on the journey.</div>

  <div class="curriculum-timeline">

    <!-- Ch 1 -->
    <div class="chapter-card" onclick="toggleChapter(this)" id="ch1">
      <div class="chapter-header">
        <div class="ch-num">Ch. 1</div>
        <div class="ch-info">
          <div class="ch-title">Google NotebookLM for Clinical Programming</div>
          <div class="ch-tagline">Source-grounded AI — get cited answers from your own study documents</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-consumer">Consumer</span>
          <span class="ch-duration">2-3 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Learn</div>
            <ul class="ch-list">
              <li>Upload protocols, SAPs, and the SDTM IG as sources</li>
              <li>Get cited answers — every response links to the source passage</li>
              <li>Generate audio overviews of complex regulatory documents</li>
              <li>Cross-document Q&A: "Does the SAP cover all SDTM IG DM requirements?"</li>
              <li>Understand what source grounding means and why it matters for pharma</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">Prerequisites</div>
            <div class="prereq-tags">
              <span class="tag">Google account</span>
              <span class="tag">Chrome browser</span>
              <span class="tag">Protocol PDF</span>
              <span class="tag">SAP PDF</span>
              <span class="tag">SDTM IG PDF</span>
            </div>
            <div class="ch-section-title" style="margin-top:16px">Key Limitation to Know</div>
            <p style="font-size:0.85rem;color:var(--text-dim)">NotebookLM cannot read CSV files, run code, or connect to external systems. It's for <em>understanding documents</em>, not processing data.</p>
          </div>
        </div>
        <div class="capstone-connection">
          <strong>How this connects to the capstone:</strong> The Spec Builder agent queries the SDTM IG and answers the same questions NotebookLM answers — "what variables are required?", "which codelist applies?" — but programmatically via <code>orchestrator/core/ig_client.py</code> instead of a browser. Same source grounding principle, automated.
        </div>
      </div>
    </div>

    <!-- Ch 2 -->
    <div class="chapter-card" onclick="toggleChapter(this)" id="ch2">
      <div class="chapter-header">
        <div class="ch-num">Ch. 2</div>
        <div class="ch-info">
          <div class="ch-title">AI Coding Assistants: Claude Code &amp; Cursor</div>
          <div class="ch-tagline">From understanding documents to actually writing code and automating tasks</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-operator">Operator</span>
          <span class="ch-duration">4-5 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Learn</div>
            <ul class="ch-list">
              <li>CLAUDE.md — the project instruction file AI always reads</li>
              <li>Skills (slash commands) — reusable multi-step workflows</li>
              <li>MCP tools — extend Claude with custom data and lookup tools</li>
              <li>Hooks — automatic checks before/after file writes</li>
              <li>Cursor: codebase indexing, inline edits, Composer</li>
              <li>Connect NotebookLM as an MCP tool to Claude Code</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">Prerequisites</div>
            <div class="prereq-tags">
              <span class="tag">Node.js 18+</span>
              <span class="tag">Python 3.11+</span>
              <span class="tag">VS Code</span>
              <span class="tag">Cursor (free)</span>
              <span class="tag">Claude Code</span>
            </div>
            <div class="ch-section-title" style="margin-top:16px">Key Files to Know</div>
            <ul class="ch-list">
              <li>CLAUDE.md (root) — the AI's project manual</li>
              <li>.claude/skills/ — all slash commands</li>
              <li>mcp_server.py — the MCP server</li>
              <li>.claude/settings.local.json — hooks config</li>
            </ul>
          </div>
        </div>
        <div class="capstone-connection">
          <strong>How this connects to the capstone:</strong> The orchestrator is triggered by the <code>/run-pipeline</code> skill. The MCP tools in <code>mcp_server.py</code> are the same ones agents use. The hook in <code>settings.local.json</code> is what guards file writes. You're not just using Claude Code — you're looking at the architecture you built in Chapter 2.
        </div>
      </div>
    </div>

    <!-- Ch 2B -->
    <div class="chapter-card" onclick="toggleChapter(this)" id="ch2b">
      <div class="chapter-header">
        <div class="ch-num">Ch. 2B</div>
        <div class="ch-info">
          <div class="ch-title">Making Your Function Library AI-Discoverable</div>
          <div class="ch-tagline">Register validated R functions so AI uses them instead of reinventing the wheel</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-operator">Operator/Builder</span>
          <span class="ch-duration">3-4 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Learn</div>
            <ul class="ch-list">
              <li>The function registry pattern — a JSON catalog of validated R functions</li>
              <li>Why AI invents custom logic without a registry (and why that's bad)</li>
              <li>How to register a function: when_to_use, dependencies, usage examples</li>
              <li>FunctionLoader class — how agents read and use the registry</li>
              <li>Parallel with SAS macro libraries</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">Key Files</div>
            <ul class="ch-list">
              <li>r_functions/function_registry.json — the registry</li>
              <li>r_functions/iso_date.R, derive_age.R, assign_ct.R</li>
              <li>orchestrator/core/function_loader.py</li>
            </ul>
            <div class="ch-section-title" style="margin-top:14px">The Three Core Functions</div>
            <p style="font-size:0.85rem;color:var(--text-dim)"><strong style="color:var(--text)">iso_date()</strong> — messy dates → ISO 8601<br><strong style="color:var(--text)">derive_age()</strong> — age from birth + reference dates<br><strong style="color:var(--text)">assign_ct()</strong> — raw values → CDISC CT</p>
          </div>
        </div>
        <div class="capstone-connection">
          <strong>How this connects to the capstone:</strong> Before the Production Programmer writes a single line of R, it calls <code>FunctionLoader.get_functions_for_prompt()</code>. The result — a list of registered functions with usage examples — is injected into the agent's system prompt. That's why the generated R code uses <code>iso_date()</code> and never writes <code>as.Date(format(...))</code> from scratch.
        </div>
      </div>
    </div>

    <!-- Ch 3 -->
    <div class="chapter-card" onclick="toggleChapter(this)" id="ch3">
      <div class="chapter-header">
        <div class="ch-num">Ch. 3</div>
        <div class="ch-info">
          <div class="ch-title">Building a RAG System for SDTM IG</div>
          <div class="ch-tagline">Build retrieval-augmented generation from scratch for SDTM domain knowledge</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-builder">Builder</span>
          <span class="ch-duration">5-6 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Learn</div>
            <ul class="ch-list">
              <li>What RAG is and why "just use ChatGPT" isn't good enough for SDTM</li>
              <li>Keyword vs semantic vs hybrid search — tradeoffs</li>
              <li>Chunking strategy: one section per variable = one chunk</li>
              <li>File-based RAG (markdown files) vs database RAG (pgvector)</li>
              <li>Build and query the IGClient API</li>
              <li>Extend to AE domain by writing ae_domain.md</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">Key Files</div>
            <ul class="ch-list">
              <li>sdtm_ig_db/sdtm_ig_content/dm_domain.md</li>
              <li>sdtm_ig_db/sdtm_ig_content/general_assumptions.md</li>
              <li>orchestrator/core/ig_client.py</li>
              <li>sdtm_ig_db/load_sdtm_ig.py (DB mode)</li>
            </ul>
            <div class="ch-section-title" style="margin-top:14px">The Key Design Choice</div>
            <p style="font-size:0.85rem;color:var(--text-dim)">File-based RAG requires no database and works offline. Database RAG (PostgreSQL + pgvector) enables semantic search. Both are supported.</p>
          </div>
        </div>
        <div class="capstone-connection">
          <strong>How this connects to the capstone:</strong> The <code>IGClient</code> you built and tested in Chapter 3 is imported directly by <code>spec_builder.py</code> and <code>spec_reviewer.py</code>. When the Spec Builder asks "what variables are required for DM?", it calls <code>ig_client.get_required_variables("DM")</code> — the exact method you implemented.
        </div>
      </div>
    </div>

    <!-- Ch 4 -->
    <div class="chapter-card" onclick="toggleChapter(this)" id="ch4">
      <div class="chapter-header">
        <div class="ch-num">Ch. 4</div>
        <div class="ch-info">
          <div class="ch-title">Querying CDISC Controlled Terminology via REST API</div>
          <div class="ch-tagline">Live CDISC CT lookups — the IG says which codelist; the API says what's in it</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-builder">Builder</span>
          <span class="ch-duration">4-5 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Learn</div>
            <ul class="ch-list">
              <li>NCI EVS REST API: concept endpoint, subset/members endpoint</li>
              <li>Extensible vs non-extensible codelists — why this matters</li>
              <li>The CT matching pipeline: raw value → synonym lookup → CDISC value</li>
              <li>Static fallback (ct_lookup.csv) for offline use</li>
              <li>Why RACE needs special handling ("Other Specify")</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">Key API Endpoints</div>
            <ul class="ch-list">
              <li>GET /concept/ncit/{code}?include=summary → codelist metadata</li>
              <li>GET /subset/ncit/{code}/members → allowed values</li>
              <li>No API key required</li>
            </ul>
            <div class="ch-section-title" style="margin-top:14px">The 4 DM Codelists</div>
            <p style="font-size:0.85rem;color:var(--text-dim)">C66731 SEX · C74457 RACE · C66790 ETHNICITY · C71113 COUNTRY — all in ct_lookup.csv as offline fallback</p>
          </div>
        </div>
        <div class="capstone-connection">
          <strong>How this connects to the capstone:</strong> The <code>assign_ct()</code> R function uses <code>macros/ct_lookup.csv</code> (which you built in Ch.4). The Spec Builder validates that every codelist-controlled variable maps to the correct codelist code. The Validation Agent checks that output values are in their respective codelists. The IG (Ch.3) told you <em>which</em> codelist — Ch.4 taught you <em>what values are in it</em>.
        </div>
      </div>
    </div>

    <!-- Ch 5 -->
    <div class="chapter-card" onclick="toggleChapter(this)" id="ch5">
      <div class="chapter-header">
        <div class="ch-num">Ch. 5</div>
        <div class="ch-info">
          <div class="ch-title">Enterprise Package Management for AI</div>
          <div class="ch-tagline">Ensure AI generates code using only your organisation's approved packages</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-builder">Builder/Architect</span>
          <span class="ch-duration">3-4 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Learn</div>
            <ul class="ch-list">
              <li>Why AI training data includes unapproved packages and wrong versions</li>
              <li>The approved package registry (JSON) — approved version, restrictions, key functions</li>
              <li>Versioned documentation: enterprise docs, not public CRAN/PyPI</li>
              <li>PackageManager class for programmatic compliance checking</li>
              <li>Four enforcement layers: CLAUDE.md → MCP → Hooks → CI/CD</li>
              <li>Context7 for exploration vs PackageManager for production</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">The Four Enforcement Layers</div>
            <ul class="ch-list">
              <li><strong style="color:var(--text)">CLAUDE.md rules</strong> — proactive: don't generate unapproved code</li>
              <li><strong style="color:var(--text)">MCP tool</strong> — informative: look up approved docs on demand</li>
              <li><strong style="color:var(--text)">Hook</strong> — reactive: scan file writes for violations</li>
              <li><strong style="color:var(--text)">CI/CD</strong> — audit gate before repository merge</li>
            </ul>
            <div class="ch-section-title" style="margin-top:14px">Real Restriction Example</div>
            <p style="font-size:0.85rem;color:var(--text-dim)">haven: "Do NOT use write_xpt(version=8). FDA requires version=5." — this restriction lives in approved_packages.json and gets injected into agent prompts.</p>
          </div>
        </div>
        <div class="capstone-connection">
          <strong>How this connects to the capstone:</strong> Every R script generated by the Production Programmer uses only <code>library(arrow)</code> and <code>library(haven)</code>. That's not accidental — it's enforced by <code>standards/coding_standards.yaml</code> which the Memory Manager injects into agent prompts. The haven restriction on <code>version=5</code> is what prevents an XPT format violation in the FDA submission.
        </div>
      </div>
    </div>

    <!-- Ch 6 -->
    <div class="chapter-card" onclick="toggleChapter(this)" id="ch6">
      <div class="chapter-header">
        <div class="ch-num">Ch. 6</div>
        <div class="ch-info">
          <div class="ch-title">Vibe Coding for Clinical Programmers</div>
          <div class="ch-tagline">AI-directed development — from SAP intent to working code using plan mode, prompting, and custom agents</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-builder">Builder/Architect</span>
          <span class="ch-duration">5-6 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Learn</div>
            <ul class="ch-list">
              <li>Plan mode: design before coding, catch edge cases before writing a line</li>
              <li>Five clinical prompting patterns: spec-first, IG-grounded, SAP-to-code, error-driven, iterative refinement</li>
              <li>Debugging with AI: error + context + intent = AI can fix it</li>
              <li>Building custom agents (AGENT.md) with different model personas</li>
              <li>Building custom skills (SKILL.md) for reusable procedures</li>
              <li>Live build: TLF search tool using RAG patterns from Ch.3</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">The Agent + Skill Architecture</div>
            <ul class="ch-list">
              <li>Agents: specialist personas (.claude/agents/*/AGENT.md)</li>
              <li>Skills: reusable procedures (.claude/skills/*/SKILL.md)</li>
              <li>Model choice matters: Opus for critical roles, Sonnet for production</li>
            </ul>
            <div class="ch-section-title" style="margin-top:14px">Key Insight</div>
            <p style="font-size:0.85rem;color:var(--text-dim)">The orchestrator itself was built using vibe coding — plan mode, iterative prompting, and debugging. When you look at main.py, you're looking at the output of the techniques from Ch.6.</p>
          </div>
        </div>
        <div class="capstone-connection">
          <strong>How this connects to the capstone:</strong> Every agent in the capstone orchestrator (<code>.claude/agents/production-programmer/AGENT.md</code>, <code>qc-programmer/AGENT.md</code>, etc.) follows the exact AGENT.md structure you built in Ch.6. The <code>/run-pipeline</code> skill is a SKILL.md file. The capstone IS the output of vibe coding applied to SDTM programming.
        </div>
      </div>
    </div>

    <!-- Ch 7 -->
    <div class="chapter-card" onclick="toggleChapter(this)" id="ch7">
      <div class="chapter-header">
        <div class="ch-num">Ch. 7</div>
        <div class="ch-info">
          <div class="ch-title">Agent Memory System</div>
          <div class="ch-tagline">Persistent decisions, pitfalls, coding standards — turn stateless agents into a learning organisation</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-builder">Builder/Architect</span>
          <span class="ch-duration">3-4 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Learn</div>
            <ul class="ch-list">
              <li>Why agents forget everything between runs — and why that's a problem</li>
              <li>Coding standards as machine-readable YAML (not a Word doc SOP)</li>
              <li>Decision records: every human review choice logged with rationale</li>
              <li>Pitfall records: every R script error and comparison mismatch logged</li>
              <li>Cross-domain context: DM decisions inform AE, VS, LB processing</li>
              <li>Pitfall promotion: study-level learnings → company-wide knowledge</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">Memory Storage</div>
            <ul class="ch-list">
              <li>standards/coding_standards.yaml — enforced company rules</li>
              <li>standards/memory/pitfalls.yaml — company-wide pitfalls</li>
              <li>studies/{study}/memory/decisions_log.yaml — study decisions</li>
              <li>studies/{study}/memory/pitfalls.yaml — study pitfalls</li>
            </ul>
            <div class="ch-section-title" style="margin-top:14px">Key Design Point</div>
            <p style="font-size:0.85rem;color:var(--text-dim)">Memory is not AI magic — it's YAML files read by agents before they run. This makes it <em>auditable, editable, and transparent</em> — exactly what regulators need.</p>
          </div>
        </div>
        <div class="capstone-connection">
          <strong>How this connects to the capstone:</strong> Open <code>orchestrator/core/memory_manager.py</code> and you'll recognise every method from Ch.7 exercises: <code>record_decision()</code>, <code>record_pitfall()</code>, <code>get_coding_standards()</code>. The memory system runs at every pipeline stage — when the Production Programmer generates R code, it has already received coding standards, past pitfalls, and DM-specific decisions in its system prompt.
        </div>
      </div>
    </div>

    <!-- Capstone -->
    <div class="chapter-card capstone" onclick="toggleChapter(this)" id="chcap">
      <div class="chapter-header">
        <div class="ch-num">Capstone</div>
        <div class="ch-info">
          <div class="ch-title">SDTM Agentic Orchestrator</div>
          <div class="ch-tagline">Everything from Chapters 1-7, running together as a full automated SDTM pipeline</div>
        </div>
        <div class="ch-meta">
          <span class="ch-level level-architect">Architect</span>
          <span class="ch-duration">6-8 hrs</span>
        </div>
        <div class="ch-toggle">▼</div>
      </div>
      <div class="chapter-body">
        <div class="ch-grid">
          <div>
            <div class="ch-section-title">What You Do</div>
            <ul class="ch-list">
              <li>Understand the 5-agent + 4-core-module architecture</li>
              <li>Run the full pipeline end-to-end (raw CSV → validated XPT)</li>
              <li>Make the human review decisions the pipeline cannot automate</li>
              <li>Trace RACE through every stage (Exercise C.1)</li>
              <li>Introduce a deliberate error and find which stage catches it (C.2)</li>
              <li>Add a new variable to the spec and watch code regenerate (C.3)</li>
              <li>Design the AE domain extension on paper (C.4)</li>
            </ul>
          </div>
          <div>
            <div class="ch-section-title">Prerequisites (ALL of these)</div>
            <div class="prereq-tags">
              <span class="tag">Ch.1-7 completed</span>
              <span class="tag">Python 3.11+</span>
              <span class="tag">R 4.x</span>
              <span class="tag">R: arrow + haven</span>
              <span class="tag">All env checks passing</span>
            </div>
            <div class="ch-section-title" style="margin-top:14px">Before You Start</div>
            <p style="font-size:0.85rem;color:var(--text-dim)">Run <code style="color:var(--gold)">python verify_setup.py</code> to check all prerequisites. Run <code style="color:var(--gold)">/capstone-checklist</code> in Claude Code at any point to see your progress.</p>
          </div>
        </div>
        <div class="capstone-connection" style="border-color:rgba(155,109,181,0.3);background:rgba(155,109,181,0.07)">
          <strong style="color:var(--purple)">The key insight:</strong> The spec is the single source of truth. Change it → code changes. Fix the spec → P21 passes. Everything flows from the spec. Human review exists to get the spec right — the rest is automated.
        </div>
      </div>
    </div>

  </div><!-- end timeline -->
</div>

<!-- ══════════════════════════════════════════════ PROGRESS -->
<hr class="divider">
<div class="section" id="progress">
  <div class="section-title">My Progress</div>
  <div class="section-sub">Track your journey through the curriculum. Progress is saved in your browser.</div>
  <button class="print-btn" onclick="window.print()">Print this page</button>

  <div class="progress-section" style="margin-top:24px">
    <div id="progress-items"></div>
    <div class="progress-bar-wrap">
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
      <div class="progress-pct" id="progress-pct">0 of 9 completed</div>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════════════ CAPSTONE DEEP DIVE -->
<hr class="divider">
<div class="section" id="capstone">
  <div class="capstone-hero">
    <h2>The Capstone: Putting It All Together</h2>
    <p>The capstone is not a new chapter — it's the proof that everything you learned in Chapters 1-7 was building toward something real. Here's the challenge map and how each problem gets solved.</p>
  </div>

  <div class="section-title">Challenge → AI Solution Map</div>
  <div class="section-sub">Every challenge below is a real problem clinical programmers face. Every solution points to the specific code and chapter that addresses it.</div>

  <table class="challenge-table">
    <thead>
      <tr>
        <th>The Challenge</th>
        <th>Why It's Hard</th>
        <th>How the Orchestrator Solves It</th>
        <th>Chapter</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><div class="challenge-text">Consulting the SDTM IG manually</div></td>
        <td><div class="hard-part">400-page PDF, manual cross-referencing for every variable in every study</div></td>
        <td><div class="ai-solution">Spec Builder calls IGClient.get_required_variables("DM") — structured retrieval from markdown</div></td>
        <td><span class="ch-tag">Ch. 3</span></td>
      </tr>
      <tr>
        <td><div class="challenge-text">Matching raw values to CDISC CT</div></td>
        <td><div class="hard-part">Codelists change quarterly, extensibility rules differ per variable, synonyms don't always match</div></td>
        <td><div class="ai-solution">assign_ct() uses ct_lookup.csv with NCI EVS REST API fallback; Validation Agent checks every value against the codelist</div></td>
        <td><span class="ch-tag">Ch. 4</span></td>
      </tr>
      <tr>
        <td><div class="challenge-text">Deciding between valid IG options</div></td>
        <td><div class="hard-part">RACE "Other Specify" has 3 valid approaches — wrong choice could conflict with regulatory guidance</div></td>
        <td><div class="ai-solution">Spec Builder flags decision_required=true, presents options with IG citations; human review gate with memory recording</div></td>
        <td><span class="ch-tag">Ch. 7</span></td>
      </tr>
      <tr>
        <td><div class="challenge-text">Writing boilerplate R code every study</div></td>
        <td><div class="hard-part">Same iso_date, derive_age, assign_ct patterns repeated across every study and domain</div></td>
        <td><div class="ai-solution">Production Programmer reads function_registry.json first — uses registered functions, never reinvents validated code</div></td>
        <td><span class="ch-tag">Ch. 2B</span></td>
      </tr>
      <tr>
        <td><div class="challenge-text">Genuine QC independence</div></td>
        <td><div class="hard-part">Same programmer doing both production and QC defeats the purpose; different people is slower</div></td>
        <td><div class="ai-solution">QC Programmer uses Opus model, never sees production code; different model = different reasoning = genuine independence</div></td>
        <td><span class="ch-tag">Ch. 6</span></td>
      </tr>
      <tr>
        <td><div class="challenge-text">Errors surfacing late at P21</div></td>
        <td><div class="hard-part">Without automated compare, issues are found at final validation — days or weeks after programming</div></td>
        <td><div class="ai-solution">Column-by-column comparison loop runs before validation; spec-driven CT checks catch codelist errors in the spec, not the data</div></td>
        <td><span class="ch-tag">Ch. 3/4</span></td>
      </tr>
      <tr>
        <td><div class="challenge-text">Package compliance in generated code</div></td>
        <td><div class="hard-part">AI training data includes every version; without constraints it may use unapproved packages or wrong API versions</div></td>
        <td><div class="ai-solution">Coding standards enforced via Memory Manager in every agent prompt; R scripts use only approved arrow + haven</div></td>
        <td><span class="ch-tag">Ch. 5</span></td>
      </tr>
      <tr>
        <td><div class="challenge-text">Agents forget between runs</div></td>
        <td><div class="hard-part">Repeat same human review decisions; same pitfalls recur; no institutional knowledge accumulates</div></td>
        <td><div class="ai-solution">MemoryManager records decisions, pitfalls, and cross-domain context; coding standards injected into every agent prompt</div></td>
        <td><span class="ch-tag">Ch. 7</span></td>
      </tr>
      <tr>
        <td><div class="challenge-text">Scaling to new domains</div></td>
        <td><div class="hard-part">Every new domain (AE, VS, LB) traditionally means rewriting agent logic from scratch</div></td>
        <td><div class="ai-solution">Domain-generic agents: read IG markdown, read spec, generate code — add ae_domain.md and run --domain AE</div></td>
        <td><span class="ch-tag">Ch. 3</span></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ══════════════════════════════════════════════ PIPELINE -->
<hr class="divider">
<div class="section" id="pipeline">
  <div class="section-title">The Pipeline</div>
  <div class="section-sub">Seven stages from raw CSV to validated XPT. One human in the middle — deliberately.</div>

  <div class="pipeline-wrap">
    <div class="pipeline">
      <div class="pipe-stage stage-spec">
        <div class="pipe-num">Stage 1</div>
        <div class="pipe-name">Spec Build</div>
        <div class="pipe-agent">Spec Builder (Sonnet)</div>
        <div class="pipe-output">dm_mapping_spec.json</div>
      </div>
      <div class="pipe-stage stage-review">
        <div class="pipe-num">Stage 2</div>
        <div class="pipe-name">Spec Review</div>
        <div class="pipe-agent">Spec Reviewer (Opus)</div>
        <div class="pipe-output">review_comments in spec</div>
      </div>
      <div class="pipe-stage special-human">
        <div class="pipe-num">Stage 3</div>
        <div class="human-badge">HUMAN</div>
        <div class="pipe-name">Human Review</div>
        <div class="pipe-agent">You make the decisions</div>
        <div class="pipe-output">dm_mapping_spec_approved.json</div>
      </div>
      <div class="pipe-stage stage-prod">
        <div class="pipe-num">Stage 4</div>
        <div class="pipe-name">Production</div>
        <div class="pipe-agent">Prod Programmer (Sonnet)</div>
        <div class="pipe-output">dm_production.R + dm.parquet</div>
      </div>
      <div class="pipe-stage stage-qc">
        <div class="pipe-num">Stage 5</div>
        <div class="pipe-name">QC</div>
        <div class="pipe-agent">QC Programmer (Opus)</div>
        <div class="pipe-output">dm_qc.R + dm_qc.parquet</div>
      </div>
      <div class="pipe-stage stage-compare">
        <div class="pipe-num">Stage 6</div>
        <div class="pipe-name">Compare</div>
        <div class="pipe-agent">compare.py</div>
        <div class="pipe-output">dm_compare_report.txt</div>
      </div>
      <div class="pipe-stage stage-validate">
        <div class="pipe-num">Stage 7</div>
        <div class="pipe-name">Validate</div>
        <div class="pipe-agent">Validation Agent (Sonnet)</div>
        <div class="pipe-output">p21_report.txt + dm.xpt</div>
      </div>
    </div>
  </div>
  <div class="pipe-loop-label">If Stage 6 produces a MISMATCH → loop back to Stage 4 (up to 5 iterations)</div>

  <div class="note">
    <strong class="highlight">Run it now:</strong>
    <code style="color:var(--gold-light);font-family:monospace"> python orchestrator/main.py --domain DM</code>
    — then use <code style="color:var(--gold-light);font-family:monospace">/capstone-checklist</code> in Claude Code to see your progress.
  </div>
</div>

<!-- ══════════════════════════════════════════════ EXERCISES -->
<hr class="divider">
<div class="section" id="exercises">
  <div class="section-title">Capstone Exercises</div>
  <div class="section-sub">Four exercises that test understanding, not just execution. Do them in order — each builds on the previous.</div>

  <div class="exercise-grid">
    <div class="exercise-card ex-c1">
      <div class="ex-time">30 min</div>
      <div class="ex-num">Exercise C.1</div>
      <div class="ex-title">Trace RACE Through the Pipeline</div>
      <div class="ex-desc">Follow the RACE variable from raw data → spec → production R → QC R → comparison → validation. Build a complete traceability table.</div>
      <div class="ex-need"><strong>What you need to know:</strong> How the spec stores variable definitions. How R code implements CT mapping. What the compare report checks. What P21 validates.</div>
      <div class="ex-skill-tip">Shortcut: <code>/trace-variable RACE DM</code> shows you the format, then understand each step manually.</div>
    </div>
    <div class="exercise-card ex-c2">
      <div class="ex-time">30 min</div>
      <div class="ex-num">Exercise C.2</div>
      <div class="ex-title">Introduce a Deliberate Error</div>
      <div class="ex-desc">Change the SEX codelist in the approved spec from C66731 (SEX) to C74457 (RACE). Re-run the pipeline and find which stage(s) detect the error.</div>
      <div class="ex-need"><strong>What you need to know:</strong> How to edit the approved spec JSON. How to re-run individual pipeline stages. Which stages validate CT compliance.</div>
      <div class="ex-skill-tip">Hint: Don't just run validation. Try production first. Which is earlier? Which catches it first?</div>
    </div>
    <div class="exercise-card ex-c3">
      <div class="ex-time">30 min</div>
      <div class="ex-num">Exercise C.3</div>
      <div class="ex-title">Add DTHFL to the Spec</div>
      <div class="ex-desc">Add a DTHFL (Death Flag) variable entry to the approved spec JSON, then re-run only the production stage. Verify DTHFL appears in the regenerated R script automatically.</div>
      <div class="ex-need"><strong>What you need to know:</strong> The structure of a variable entry in the spec JSON. How to run a single pipeline stage. What "--stage production" does.</div>
      <div class="ex-skill-tip">Key insight: you only changed the spec — not the R code. The code was regenerated from scratch from the spec. That's what "spec-driven" means.</div>
    </div>
    <div class="exercise-card ex-c4">
      <div class="ex-time">30 min</div>
      <div class="ex-num">Exercise C.4</div>
      <div class="ex-title">Design the AE Domain Extension</div>
      <div class="ex-desc">On paper: design how the orchestrator would support the AE domain. Which existing components work unchanged? What needs to be added? What's the hardest problem?</div>
      <div class="ex-need"><strong>What you need to know:</strong> Which orchestrator components are domain-generic. What Ch.3's ae_domain.md does. Why AEDECOD is harder than any DM variable.</div>
      <div class="ex-skill-tip">Hint: look at how domain-generic ig_client.py is. Then think about what AE adds that DM doesn't have (MedDRA coding is not CT mapping).</div>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════════════ AGENTS -->
<hr class="divider">
<div class="section" id="agents">
  <div class="section-title">The 5 Pipeline Agents</div>
  <div class="section-sub">Each agent has a role, a model, and a reason for that model choice. Model selection is not arbitrary.</div>

  <div class="agents-grid">
    <div class="agent-card">
      <div class="agent-icon">🔍</div>
      <div class="agent-name">Spec Builder</div>
      <div class="agent-model model-sonnet">claude-sonnet</div>
      <div class="agent-role">Profiles raw data, queries the IG, builds the draft mapping spec with decision flags for human review.</div>
      <div class="agent-reads"><strong>Reads:</strong> raw_dm.csv, ig_client, function_registry.json, memory (pitfalls, past decisions)</div>
    </div>
    <div class="agent-card">
      <div class="agent-icon">✅</div>
      <div class="agent-name">Spec Reviewer</div>
      <div class="agent-model model-opus">claude-opus</div>
      <div class="agent-role">IG-driven completeness check. Verifies every required variable is present, every codelist is valid, every derivation is logical. Opus for critical review.</div>
      <div class="agent-reads"><strong>Reads:</strong> draft spec, ig_client (required variables), CDISC CT codelists</div>
    </div>
    <div class="agent-card">
      <div class="agent-icon">👤</div>
      <div class="agent-name">Human Review Gate</div>
      <div class="agent-model" style="background:rgba(224,124,76,0.2);color:var(--orange)">You</div>
      <div class="agent-role">Not an agent. You review the spec, see each decision point with options and IG rationale, and make the call. Memory records your decision for future runs.</div>
      <div class="agent-reads"><strong>Reviews:</strong> flagged variables, decision options, IG citations, past decisions from memory</div>
    </div>
    <div class="agent-card">
      <div class="agent-icon">⚙️</div>
      <div class="agent-name">Production Programmer</div>
      <div class="agent-model model-sonnet">claude-sonnet</div>
      <div class="agent-role">Reads the approved spec and function registry, generates R script, executes it with Rscript. If the script fails, the pipeline stops.</div>
      <div class="agent-reads"><strong>Reads:</strong> approved spec, function_registry.json, coding standards from memory, package restrictions</div>
    </div>
    <div class="agent-card">
      <div class="agent-icon">🔎</div>
      <div class="agent-name">QC Programmer</div>
      <div class="agent-model model-opus">claude-opus</div>
      <div class="agent-role">Independent re-implementation. Uses a different model, never sees production code. Opus challenges assumptions that Sonnet accepted. This is genuine QC independence.</div>
      <div class="agent-reads"><strong>Reads:</strong> approved spec, function_registry.json (same as production, nothing else)</div>
    </div>
    <div class="agent-card">
      <div class="agent-icon">📋</div>
      <div class="agent-name">Validation Agent</div>
      <div class="agent-model model-sonnet">claude-sonnet</div>
      <div class="agent-role">P21-style checks: required variables, CT values in codelists, ISO 8601 dates, USUBJID format, types/lengths. Also generates define.xml metadata and spec sheet.</div>
      <div class="agent-reads"><strong>Reads:</strong> dm.parquet, approved spec (for codelist rules), IG (for required variable list)</div>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════════════ QUICK REFERENCE -->
<hr class="divider">
<div class="section" id="reference">
  <div class="section-title">Quick Reference</div>
  <div class="section-sub">Commands and skills for the capstone session. Keep this open while you work.</div>

  <div class="ref-grid">
    <div class="ref-card">
      <h3>Pipeline Commands</h3>
      <ul class="cmd-list">
        <li><span class="cmd">python verify_setup.py</span><span class="cmd-desc">— check prerequisites</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM</span><span class="cmd-desc">— full pipeline</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM --stage spec_build</span><span class="cmd-desc">— single stage</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM --stage human_review</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM --stage production</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM --stage qc</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM --stage compare</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM --stage validate</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM --resume</span><span class="cmd-desc">— after crash</span></li>
        <li><span class="cmd">python orchestrator/main.py --domain DM --force</span><span class="cmd-desc">— skip spec review failure</span></li>
      </ul>
    </div>
    <div class="ref-card">
      <h3>Claude Code Skills</h3>
      <ul class="cmd-list">
        <li><span class="cmd">/check-environment</span><span class="cmd-desc">— verify all prerequisites</span></li>
        <li><span class="cmd">/run-pipeline</span><span class="cmd-desc">— full pipeline</span></li>
        <li><span class="cmd">/run-pipeline [stage]</span><span class="cmd-desc">— specific stage</span></li>
        <li><span class="cmd">/capstone-checklist</span><span class="cmd-desc">— check your progress</span></li>
        <li><span class="cmd">/trace-variable RACE DM</span><span class="cmd-desc">— full variable trace</span></li>
        <li><span class="cmd">/explain-pipeline [stage]</span><span class="cmd-desc">— what a stage does</span></li>
        <li><span class="cmd">/explain-pipeline [filename]</span><span class="cmd-desc">— what a file is</span></li>
        <li><span class="cmd">/validate-dataset</span><span class="cmd-desc">— run P21-style checks</span></li>
        <li><span class="cmd">/profile-data</span><span class="cmd-desc">— profile raw data</span></li>
        <li><span class="cmd">/review-spec</span><span class="cmd-desc">— interactive spec review</span></li>
      </ul>
    </div>
    <div class="ref-card">
      <h3>Key Output Files</h3>
      <ul class="cmd-list">
        <li><span class="cmd">outputs/specs/dm_mapping_spec.json</span><span class="cmd-desc">— draft spec</span></li>
        <li><span class="cmd">outputs/specs/dm_mapping_spec_approved.json</span><span class="cmd-desc">— after human review</span></li>
        <li><span class="cmd">outputs/programs/dm_production.R</span><span class="cmd-desc">— generated R script</span></li>
        <li><span class="cmd">outputs/datasets/dm.parquet</span><span class="cmd-desc">— production dataset</span></li>
        <li><span class="cmd">outputs/qc/dm_qc.R</span><span class="cmd-desc">— independent QC script</span></li>
        <li><span class="cmd">outputs/qc/dm_qc.parquet</span><span class="cmd-desc">— QC dataset</span></li>
        <li><span class="cmd">outputs/qc/dm_compare_report.txt</span><span class="cmd-desc">— comparison results</span></li>
        <li><span class="cmd">outputs/validation/p21_report.txt</span><span class="cmd-desc">— P21 results</span></li>
        <li><span class="cmd">outputs/validation/dm.xpt</span><span class="cmd-desc">— SAS transport for FDA</span></li>
        <li><span class="cmd">outputs/pipeline_state.json</span><span class="cmd-desc">— current pipeline state</span></li>
      </ul>
    </div>
    <div class="ref-card">
      <h3>Key Codelists (DM)</h3>
      <ul class="cmd-list">
        <li><span class="cmd">C66731</span><span class="cmd-desc">— SEX (non-extensible: M, F, U)</span></li>
        <li><span class="cmd">C74457</span><span class="cmd-desc">— RACE (extensible: WHITE, BLACK, etc.)</span></li>
        <li><span class="cmd">C66790</span><span class="cmd-desc">— ETHNICITY (HISPANIC, NOT HISPANIC, etc.)</span></li>
        <li><span class="cmd">C71113</span><span class="cmd-desc">— COUNTRY (ISO 3166 alpha-3)</span></li>
        <li><span class="cmd">C49487</span><span class="cmd-desc">— YES/NO</span></li>
        <li><span class="cmd">C66742</span><span class="cmd-desc">— NY (Yes/No responses)</span></li>
      </ul>
      <h3 style="margin-top:16px">The 3 R Functions</h3>
      <ul class="cmd-list">
        <li><span class="cmd">iso_date(x)</span><span class="cmd-desc">— messy dates → ISO 8601</span></li>
        <li><span class="cmd">derive_age(birth, ref)</span><span class="cmd-desc">— AGE from dates</span></li>
        <li><span class="cmd">assign_ct(x, codelist)</span><span class="cmd-desc">— raw → CDISC CT</span></li>
      </ul>
    </div>
  </div>
</div>

<footer>
  AI for Clinical Programming — Training Curriculum · Study: XYZ-2026-001 (fictitious Phase III T2DM) · Built for learning. Break things. Ask questions. Have fun.
</footer>

<script>
// ── CHAPTER TOGGLE ──
function toggleChapter(card) {
  card.classList.toggle('open');
}

// ── PROGRESS TRACKER ──
const chapters = [
  { id: 'ch1-done', label: 'Chapter 1: Google NotebookLM — Completed' },
  { id: 'ch2-done', label: 'Chapter 2: AI Coding Assistants — Completed' },
  { id: 'ch2b-done', label: 'Chapter 2B: Function Library — Completed' },
  { id: 'ch3-done', label: 'Chapter 3: RAG System — Completed' },
  { id: 'ch4-done', label: 'Chapter 4: REST API for CDISC CT — Completed' },
  { id: 'ch5-done', label: 'Chapter 5: Enterprise Package Management — Completed' },
  { id: 'ch6-done', label: 'Chapter 6: Vibe Coding — Completed' },
  { id: 'ch7-done', label: 'Chapter 7: Agent Memory System — Completed' },
  { id: 'cap-done', label: 'Capstone: SDTM Agentic Orchestrator — Completed' },
];

function renderProgress() {
  const container = document.getElementById('progress-items');
  container.innerHTML = '';
  let checked = 0;
  chapters.forEach(ch => {
    const isChecked = localStorage.getItem(ch.id) === 'true';
    if (isChecked) checked++;
    const row = document.createElement('div');
    row.className = 'progress-row';
    const box = document.createElement('div');
    box.className = 'progress-checkbox' + (isChecked ? ' checked' : '');
    box.onclick = () => {
      const current = localStorage.getItem(ch.id) === 'true';
      localStorage.setItem(ch.id, !current);
      renderProgress();
    };
    const label = document.createElement('div');
    label.className = 'progress-label' + (isChecked ? ' checked' : '');
    label.textContent = ch.label;
    row.appendChild(box);
    row.appendChild(label);
    container.appendChild(row);
  });
  const pct = Math.round((checked / chapters.length) * 100);
  document.getElementById('progress-fill').style.width = pct + '%';
  document.getElementById('progress-pct').textContent = checked + ' of ' + chapters.length + ' completed (' + pct + '%)';
}

renderProgress();

// ── SMOOTH SCROLL ──
document.querySelectorAll('a[href^="#"]').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const target = document.querySelector(link.getAttribute('href'));
    if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
});

// ── ACTIVE NAV ──
const sections = document.querySelectorAll('.section[id]');
const navLinks = document.querySelectorAll('.nav a');
window.addEventListener('scroll', () => {
  let current = '';
  sections.forEach(s => {
    if (window.scrollY >= s.offsetTop - 80) current = s.id;
  });
  navLinks.forEach(link => {
    link.classList.remove('active');
    if (link.getAttribute('href') === '#' + current) link.classList.add('active');
  });
});
</script>
</body>
</html>
